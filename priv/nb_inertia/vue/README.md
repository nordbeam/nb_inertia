# NbInertia Enhanced Vue Components

Enhanced Inertia.js components for Vue 3 that provide automatic integration with nb_routes rich mode.

## Overview

This package provides Vue 3 wrapper components that accept both standard string URLs and RouteResult objects from nb_routes rich mode, enabling type-safe routing with automatic method detection.

## Features

- **Enhanced Router**: Accepts RouteResult objects with automatic method extraction
- **Enhanced Link Component**: Vue SFC that works with both strings and RouteResult objects
- **Enhanced useForm Composable**: Optional route binding for simplified form submission
- **Full Backward Compatibility**: All components work with standard Inertia.js patterns
- **TypeScript Support**: Full type safety with proper type inference

## Components

### router

Enhanced Inertia.js router that accepts RouteResult objects.

```typescript
import { router } from '@/lib/inertia';
import { post_path, update_post_path } from '@/routes';

// With RouteResult (method auto-detected)
router.visit(post_path(1));                    // Uses GET
router.visit(update_post_path.patch(1));       // Uses PATCH

// Still works with plain strings
router.visit('/posts/1');
router.get('/posts/1');
router.post('/posts', { title: 'New Post' });
```

### Link Component

Enhanced Link component that accepts RouteResult objects.

```vue
<script setup>
import { Link } from '@/lib/inertia';
import { post_path, update_post_path, delete_post_path } from '@/routes';
</script>

<template>
  <!-- With RouteResult objects -->
  <Link :href="post_path(1)">View Post</Link>
  <Link :href="update_post_path.patch(1)">Edit Post</Link>
  <Link :href="delete_post_path.delete(1)" as="button">Delete</Link>

  <!-- Still works with plain strings -->
  <Link href="/posts/1">View Post</Link>
  <Link href="/posts" method="post">Create Post</Link>

  <!-- With additional Inertia options -->
  <Link
    :href="post_path(1)"
    preserve-state
    preserve-scroll
    :only="['post']"
  >
    View Post
  </Link>
</template>
```

### useForm Composable

Enhanced useForm composable with optional route binding.

```vue
<script setup lang="ts">
import { useForm } from '@/lib/inertia';
import { update_post_path } from '@/routes';

// Bound to a route - submit() is simplified
const form = useForm(
  { title: 'My Post', content: 'Content here' },
  update_post_path.patch(1)
);

const handleSubmit = () => {
  form.submit({
    preserveScroll: true,
    onSuccess: () => console.log('Saved!'),
  });
};

// Not bound - works like standard Inertia
const unboundForm = useForm({ title: 'My Post' });

const handleUnboundSubmit = () => {
  unboundForm.submit('patch', `/posts/${postId}`, {
    preserveScroll: true,
    onSuccess: () => console.log('Saved!'),
  });
};
</script>

<template>
  <form @submit.prevent="handleSubmit">
    <input v-model="form.title" type="text" />
    <button type="submit" :disabled="form.processing">Save</button>
  </form>
</template>
```

## Installation

When using the nb_inertia installer with Vue, these components are automatically set up:

```bash
mix nb_inertia.install --client-framework vue --typescript
```

The installer creates `assets/js/lib/inertia.ts` that re-exports these enhanced components:

```typescript
// Generated by installer
export { router } from '@nordbeam/nb-inertia/vue/router';
export { default as Link } from '@nordbeam/nb-inertia/vue/Link.vue';
export { useForm } from '@nordbeam/nb-inertia/vue/useForm';

// Re-export everything else from Inertia
export * from '@inertiajs/vue3';
```

## Usage with nb_routes

These components are designed to work seamlessly with nb_routes rich mode:

1. **Configure nb_routes** for rich mode:

```elixir
# config/config.exs
config :nb_routes,
  variant: :rich,
  with_methods: true,
  with_forms: true
```

2. **Generate route helpers**:

```bash
mix nb_routes.gen
```

3. **Import and use in Vue components**:

```vue
<script setup lang="ts">
import { router, Link, useForm } from '@/lib/inertia';
import { user_path, update_user_path } from '@/routes';

const form = useForm(
  { name: 'John Doe', email: 'john@example.com' },
  update_user_path.patch(1)
);
</script>

<template>
  <div>
    <Link :href="user_path(1)">View User</Link>

    <form @submit.prevent="form.submit()">
      <input v-model="form.name" type="text" />
      <input v-model="form.email" type="email" />
      <button type="submit" :disabled="form.processing">Update</button>
    </form>
  </div>
</template>
```

## Key Differences from React Implementation

While the Vue components mirror the React implementation in functionality, there are some key differences due to Vue's architecture:

1. **Link Component**:
   - Vue: Single File Component (`.vue`) using `<script setup>`
   - React: TSX functional component
   - Vue uses computed properties for reactive prop transformations

2. **useForm Composable**:
   - Vue: Composable function (Composition API pattern)
   - React: React hook
   - Vue's `data` is accessed via `form.data()` while React uses `form.data` directly

3. **Template Syntax**:
   - Vue: Uses `:href` binding for dynamic props
   - React: Uses `{curly braces}` for dynamic props

4. **Type System**:
   - Both use TypeScript
   - Vue uses `defineProps` with TypeScript interfaces
   - React uses typed functional component props

## Type Safety

All components are fully typed with TypeScript:

```typescript
export type RouteResult = {
  url: string;
  method: 'get' | 'post' | 'put' | 'patch' | 'delete' | 'head';
};

export interface LinkProps {
  href: string | RouteResult;
  method?: Method;
  // ... other Inertia Link props
}

export interface BoundFormType<TForm> {
  submit(options?: VisitOptions): void;
  // ... all other useForm properties
}
```

## Testing

The components are fully tested using Vitest and Vue Test Utils:

```bash
# Run tests
npm test

# Run tests in watch mode
npm run test:watch

# Run tests with coverage
npm run test:coverage
```

Test coverage includes:
- Router with RouteResult objects and plain strings
- Link component with various prop combinations
- useForm composable with bound and unbound routes
- Type guard validation
- Edge cases and error handling

## Backward Compatibility

All components maintain full backward compatibility with standard Inertia.js usage:

- Plain string URLs work everywhere
- Explicit method props override RouteResult methods
- All Inertia options are passed through unchanged
- No breaking changes to existing Inertia applications

## Related Packages

- **nb_routes**: Type-safe route helpers with rich mode support
- **nb_inertia**: Declarative page DSL and type-safe props for Inertia.js
- **nb_ts**: TypeScript type generation from Elixir serializers
- **@nordbeam/nb-inertia**: NPM package containing these enhanced components

## License

See the main nb_inertia package for license information.
